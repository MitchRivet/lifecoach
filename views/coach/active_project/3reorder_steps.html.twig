<html>
    <head>
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

        <title>{{ project.getName }}: Re-order steps</title>
        <script src="http://rubaxa.github.io/Sortable/Sortable.js"></script>

    </head>
    <body>
        <div class="container">
            <p>
                Perhaps the order of the steps is stopping you from making progress.
            </p>

            <p>Try re-ordering them and see if it looks any better.</p>

            <!-- List with handle -->
            {# populate list with steps from current project #}
                {% if steps is not empty %}
                    <div id="step_list" class="list-group">
                        {% for step in steps %}
                            <div class="list-group-item" data-id="{{ step.getId }}">
                                <span class="drag-handle">&#9776;</span>
                              {{ loop.index }}. {{ step.getDescription }}
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <span>No steps whadda hell??</span>
                {% endif %}
            {# end populate list #}

          <p><a id="update_link" href="#">Update</a></p>
          <p><a href="/coach/active_project/{{ project.getId }}/next_step">Looks good, I'm ready to move on.</a></p>
          <p><a href="/coach/active_project/{{ project.getId }}/add_step">I'm not quite comfortable yet. Think I might need to add more steps.</a></p>

        <script>
            var update_link = document.getElementById('update_link');

            // Create steps list
            var sort = Sortable.create(step_list, {
                animation: 150,
                dataIdAttr: 'data-id'
            });

            // Define step ids using Twig so we can update them
            var step_ids = [
                {% for step in steps %}
                    {{ step.getId }}

                    {# only add a comma to steps b4 last one #}
                    {% if loop.index != steps|length %}
                        ,
                    {% endif %}
                {% endfor %}
            ];

            update_link.onclick = function()
            {
                var get_url = "/coach/active_project/{{ project.getId }}/reorder_steps?";
                var new_positions = sort.toArray();

                // Pass new step positions in URL in format step_id=new_postition
                for (i = 0; i < step_ids.length; i++)
                {
                    get_url += new_positions[i] += "=" + (i+1) + "&";
                }

                window.location.href = get_url;
            }

        </script>
        </div>
    </body>
</html>
